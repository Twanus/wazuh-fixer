---
# handlers file for win_rename_guest_account
- name: Win_rename_guest_account_verify_name
  ansible.windows.win_shell: |
    Start-Sleep -Seconds 2
    $guest = Get-CimInstance -Query "SELECT * FROM Win32_UserAccount WHERE LocalAccount = TRUE AND SID LIKE 'S-1-5-21-%-501'" -ErrorAction SilentlyContinue
    if ($guest) {
      Write-Output $guest.Name
    } else {
      Write-Output "NotFound"
    }
  register: win_rename_guest_account_verify_name
  changed_when: false
