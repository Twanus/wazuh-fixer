# win_audit_application_group_management

This role remediates CIS Benchmark 17.2.1 (check 26140): Ensure 'Audit Application Group Management' is set to 'Success and Failure'.

## Description

This policy setting allows you to audit events generated by changes to application groups such as the following:
- Application group is created, changed, or deleted.
- Member is added or removed from an application group.

Application groups are utilized by Windows Authorization Manager, which is a flexible framework created by Microsoft for integrating role-based access control (RBAC) into applications. More information on Windows Authorization Manager is available at [MSDN - Windows Authorization Manager](https://learn.microsoft.com/en-us/windows/win32/azman/about-authorization-manager).

**Note**: Although Microsoft "Deprecated" Windows Authorization Manager (AzMan) in Windows Server 2012 and 2012 R2, this feature still exists in the OS (unimproved), and therefore should still be audited.

The recommended state for this setting is: **Success and Failure**.

Auditing events in this category may be useful when investigating an incident.

## Requirements

- Ansible 2.9 or higher
- Windows target host
- WinRM connectivity
- Appropriate permissions to modify audit policies (typically requires Administrator privileges)
- The target system must support Advanced Audit Policy Configuration (Windows Vista or later)

## Role Variables

This role does not require any variables as the audit policy setting is configured to the CIS Benchmark requirement (Success and Failure).

## Dependencies

None.

## Example Playbook

```yaml
---
- name: Configure Application Group Management audit policy
  hosts: windows
  gather_facts: true
  become: false
  roles:
    - role: twanus.wazuh_fixer.win_audit_application_group_management
```

Or using the development path:

```yaml
---
- name: Configure Application Group Management audit policy
  hosts: windows
  gather_facts: true
  become: false
  roles:
    - role: ../roles/win_audit_application_group_management  # noqa role-name[path]
```

## Compliance

This role addresses the following compliance requirements:

- **CIS Benchmark**: 17.2.1 (check 26140)
- **CIS CSC v7**: 6.3
- **CIS CSC v8**: 8.5
- **CMMC v2.0**: AU.L2-3.3.1
- **ISO 27001:2013**: A.12.4.1
- **NIST SP 800-53**: AU-3(1), AU-7
- **PCI DSS v3.2.1**: 10.1, 10.2.2, 10.2.4, 10.2.5, 10.3
- **PCI DSS v4.0**: 10.2, 10.2.1, 10.2.1.2, 10.2.1.5, 9.4.5
- **SOC 2**: CC5.2, CC7.2

## Audit Policy Details

- **Subcategory**: Application Group Management
- **Subcategory GUID**: {0CCE9238-69AE-11D9-BED3-505054503030}
- **Required Setting**: Success and Failure
- **Configuration Method**: Advanced Audit Policy Configuration via `auditpol.exe`
- **Group Policy Path**: Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Application Group Management

## Verification

You can verify the setting using the command line:

```powershell
auditpol.exe /get /subcategory:"Application Group Management"
```

The output should show:
```
Subcategory:          Application Group Management
Subcategory GUID:     {0CCE9238-69AE-11D9-BED3-505054503030}
Inclusion Setting:    Success and Failure
Exclusion Setting:    <No Auditing>
```

Or using PowerShell:

```powershell
$auditPolicy = auditpol.exe /get /subcategory:"Application Group Management"
if ($auditPolicy -match "Success and Failure") {
    Write-Host "Policy is correctly configured"
} else {
    Write-Host "Policy needs to be configured"
}
```

## Idempotency

This role is idempotent. If the audit policy is already set to "Success and Failure", no changes will be made and the role will report that the setting is already configured correctly.

## Notes

- This role uses `auditpol.exe` to configure the Advanced Audit Policy subcategory directly.
- The role requires Administrator privileges to modify audit policies.
- This setting is part of the Account Management audit policy category.
- Application groups are used by Windows Authorization Manager (AzMan) for role-based access control.
- Even though AzMan was deprecated in Windows Server 2012/2012 R2, the feature still exists and should be audited.
- Enabling both success and failure auditing for this subcategory helps with incident investigation.
- The audit events will be logged to the Windows Security event log.

## Security Benefits

- **Incident Investigation**: Auditing application group changes helps identify unauthorized modifications to application groups and their members.
- **Compliance**: Meets multiple compliance framework requirements for audit logging.
- **Accountability**: Provides an audit trail of who created, modified, or deleted application groups.
- **Security Monitoring**: Enables detection of suspicious activity related to application group management.
