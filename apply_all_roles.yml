---
# Comprehensive CIS Benchmark Remediation Playbook
# This playbook applies all roles except those that could break network connections:
# - Windows Firewall roles (could block network access)
# - win_uac_apply_restrictions_local_accounts_network_logons (breaks WinRM for local admin accounts)
# - win_winrm_service_disabled (would disable WinRM, breaking Ansible connectivity)
#
# Usage: ansible-playbook -i inventory.ini apply_all_roles.yml
#
# Note: Before running, ensure:
#   1. Your inventory.ini file is configured with correct Windows host information
#   2. You have WinRM connectivity to your Windows hosts
#   3. You are using domain accounts OR accept that local admin accounts won't work for WinRM
#
# Total roles included: 145

- name: Apply All CIS Benchmark Roles (Safe for Network Connections)
  hosts: windows
  gather_facts: true
  become: false
  roles:
    - role: ../roles/win_account_lockout_duration  # noqa role-name[path]
    - role: ../roles/win_account_lockout_reset  # noqa role-name[path]
    - role: ../roles/win_account_lockout_threshold  # noqa role-name[path]
    - role: ../roles/win_allow_online_tips_disabled  # noqa role-name[path]
    - role: ../roles/win_audit_application_group_management  # noqa role-name[path]
    - role: ../roles/win_audit_audit_policy_change  # noqa role-name[path]
    - role: ../roles/win_audit_authentication_policy_change  # noqa role-name[path]
    - role: ../roles/win_audit_authorization_policy_change  # noqa role-name[path]
    - role: ../roles/win_audit_credential_validation  # noqa role-name[path]
    - role: ../roles/win_audit_file_share  # noqa role-name[path]
    - role: ../roles/win_audit_group_membership  # noqa role-name[path]
    - role: ../roles/win_audit_ipsec_driver  # noqa role-name[path]
    - role: ../roles/win_audit_logoff  # noqa role-name[path]
    - role: ../roles/win_audit_logon  # noqa role-name[path]
    - role: ../roles/win_audit_mpssvc_rule_level_policy_change  # noqa role-name[path]
    - role: ../roles/win_audit_other_logon_logoff_events  # noqa role-name[path]
    - role: ../roles/win_audit_other_object_access_events  # noqa role-name[path]
    - role: ../roles/win_audit_other_policy_change_events  # noqa role-name[path]
    - role: ../roles/win_audit_other_system_events  # noqa role-name[path]
    - role: ../roles/win_audit_pnp_activity  # noqa role-name[path]
    - role: ../roles/win_audit_process_creation  # noqa role-name[path]
    - role: ../roles/win_audit_removable_storage  # noqa role-name[path]
    - role: ../roles/win_audit_security_group_management  # noqa role-name[path]
    - role: ../roles/win_audit_security_state_change  # noqa role-name[path]
    - role: ../roles/win_audit_security_system_extension  # noqa role-name[path]
    - role: ../roles/win_audit_sensitive_privilege_use  # noqa role-name[path]
    - role: ../roles/win_audit_shutdown_on_fail  # noqa role-name[path]
    - role: ../roles/win_audit_special_logon  # noqa role-name[path]
    - role: ../roles/win_audit_system_integrity  # noqa role-name[path]
    - role: ../roles/win_audit_user_account_management  # noqa role-name[path]
    - role: ../roles/win_block_ms_accounts  # noqa role-name[path]
    - role: ../roles/win_bluetooth_audio_gateway_service_disabled  # noqa role-name[path]
    - role: ../roles/win_bluetooth_support_service_disabled  # noqa role-name[path]
    - role: ../roles/win_computer_browser_service_disabled  # noqa role-name[path]
    - role: ../roles/win_domain_encrypt_secure_channel  # noqa role-name[path]
    - role: ../roles/win_domain_encrypt_secure_channel_when_possible  # noqa role-name[path]
    - role: ../roles/win_domain_max_machine_pwd_age  # noqa role-name[path]
    - role: ../roles/win_domain_require_strong_key  # noqa role-name[path]
    - role: ../roles/win_domain_sign_secure_channel_when_possible  # noqa role-name[path]
    - role: ../roles/win_downloaded_maps_manager_disabled  # noqa role-name[path]
    - role: ../roles/win_force_audit_subcategory  # noqa role-name[path]
    - role: ../roles/win_ftp_service_disabled  # noqa role-name[path]
    - role: ../roles/win_geolocation_service_disabled  # noqa role-name[path]
    - role: ../roles/win_guest_account_status  # noqa role-name[path]
    - role: ../roles/win_iis_admin_service_disabled  # noqa role-name[path]
    - role: ../roles/win_infrared_monitor_service_disabled  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_cached_logons_count  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_dont_display_last_user  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_machine_inactivity_limit  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_machine_lockout_threshold  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_message_title  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_password_expiry_warning  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_require_ctrl_alt_del  # noqa role-name[path]
    - role: ../roles/win_interactive_logon_smart_card_removal  # noqa role-name[path]
    - role: ../roles/win_iscsi_initiator_service_disabled  # noqa role-name[path]
    - role: ../roles/win_limit_blank_password_use  # noqa role-name[path]
    - role: ../roles/win_link_layer_topology_discovery_mapper_disabled  # noqa role-name[path]
    - role: ../roles/win_lxss_manager_service_disabled  # noqa role-name[path]
    - role: ../roles/win_max_pwd_age  # noqa role-name[path]
    - role: ../roles/win_min_pwd_age  # noqa role-name[path]
    - role: ../roles/win_min_pwd_length  # noqa role-name[path]
    - role: ../roles/win_mobile_hotspot_service_disabled  # noqa role-name[path]
    - role: ../roles/win_ms_network_client_plaintext_password  # noqa role-name[path]
    - role: ../roles/win_ms_network_client_sign_always  # noqa role-name[path]
    - role: ../roles/win_ms_network_client_sign_if_server_agrees  # noqa role-name[path]
    - role: ../roles/win_ms_network_server_disconnect_logon_hours  # noqa role-name[path]
    - role: ../roles/win_ms_network_server_idle_timeout  # noqa role-name[path]
    - role: ../roles/win_ms_network_server_sign_always  # noqa role-name[path]
    - role: ../roles/win_ms_network_server_sign_if_client_agrees  # noqa role-name[path]
    - role: ../roles/win_ms_network_server_spn_validation  # noqa role-name[path]
    - role: ../roles/win_network_access_disable_cred_storage  # noqa role-name[path]
    - role: ../roles/win_network_access_everyone_includes_anonymous  # noqa role-name[path]
    - role: ../roles/win_network_access_null_session_pipes  # noqa role-name[path]
    - role: ../roles/win_network_access_null_session_shares  # noqa role-name[path]
    - role: ../roles/win_network_access_remotely_accessible_registry_paths  # noqa role-name[path]
    - role: ../roles/win_network_access_remotely_accessible_registry_paths_and_subpaths  # noqa role-name[path]
    - role: ../roles/win_network_access_restrict_anonymous  # noqa role-name[path]
    - role: ../roles/win_network_access_restrict_anonymous_access_named_pipes_shares  # noqa role-name[path]
    - role: ../roles/win_network_access_restrict_anonymous_sam  # noqa role-name[path]
    - role: ../roles/win_network_access_restrict_remote_sam  # noqa role-name[path]
    - role: ../roles/win_network_access_sharing_security_model  # noqa role-name[path]
    - role: ../roles/win_network_security_allow_localsystem_null_session_fallback  # noqa role-name[path]
    - role: ../roles/win_network_security_force_logoff_logon_hours_expire  # noqa role-name[path]
    - role: ../roles/win_network_security_kerberos_encryption_types  # noqa role-name[path]
    - role: ../roles/win_network_security_lan_manager_auth_level  # noqa role-name[path]
    - role: ../roles/win_network_security_ldap_client_signing  # noqa role-name[path]
    - role: ../roles/win_network_security_local_system_computer_identity  # noqa role-name[path]
    - role: ../roles/win_network_security_minimum_session_security_ntlm_ssp_clients  # noqa role-name[path]
    - role: ../roles/win_network_security_minimum_session_security_ntlm_ssp_servers  # noqa role-name[path]
    - role: ../roles/win_network_security_no_lm_hash  # noqa role-name[path]
    - role: ../roles/win_network_security_pku2u_allow_online_id  # noqa role-name[path]
    - role: ../roles/win_network_security_restrict_ntlm_audit_incoming  # noqa role-name[path]
    - role: ../roles/win_network_security_restrict_ntlm_audit_outgoing  # noqa role-name[path]
    - role: ../roles/win_online_speech_recognition_disabled  # noqa role-name[path]
    - role: ../roles/win_openssh_ssh_server_disabled  # noqa role-name[path]
    - role: ../roles/win_peer_name_resolution_protocol_service_disabled  # noqa role-name[path]
    - role: ../roles/win_peer_networking_grouping_disabled  # noqa role-name[path]
    - role: ../roles/win_peer_networking_identity_manager_disabled  # noqa role-name[path]
    - role: ../roles/win_pnrp_machine_name_publication_service_disabled  # noqa role-name[path]
    - role: ../roles/win_prevent_lock_screen_camera  # noqa role-name[path]
    - role: ../roles/win_prevent_lock_screen_slideshow  # noqa role-name[path]
    - role: ../roles/win_prevent_printer_drivers  # noqa role-name[path]
    - role: ../roles/win_print_rpc_privacy  # noqa role-name[path]
    - role: ../roles/win_print_spooler_service_disabled  # noqa role-name[path]
    - role: ../roles/win_pushtoinstall_service_disabled  # noqa role-name[path]
    - role: ../roles/win_pwd_hist_size  # noqa role-name[path]
    - role: ../roles/win_relax_pwd_length_limits  # noqa role-name[path]
    - role: ../roles/win_remote_access_auto_connection_manager_disabled  # noqa role-name[path]
    - role: ../roles/win_remote_desktop_configuration_service_disabled  # noqa role-name[path]
    - role: ../roles/win_remote_desktop_services_disabled  # noqa role-name[path]
    - role: ../roles/win_remote_desktop_services_usermode_port_redirector_disabled  # noqa role-name[path]
    - role: ../roles/win_remote_registry_disabled  # noqa role-name[path]
    - role: ../roles/win_rename_admin_account  # noqa role-name[path]
    - role: ../roles/win_rename_guest_account  # noqa role-name[path]
    - role: ../roles/win_routing_remote_access_service_disabled  # noqa role-name[path]
    - role: ../roles/win_rpc_locator_service_disabled  # noqa role-name[path]
    - role: ../roles/win_server_service_disabled  # noqa role-name[path]
    - role: ../roles/win_simple_tcpip_services_disabled  # noqa role-name[path]
    - role: ../roles/win_smb_v1_client_driver_disabled  # noqa role-name[path]
    - role: ../roles/win_smb_v1_server_disabled  # noqa role-name[path]
    - role: ../roles/win_snmp_service_disabled  # noqa role-name[path]
    - role: ../roles/win_special_administration_console_helper_disabled  # noqa role-name[path]
    - role: ../roles/win_ssdp_discovery_service_disabled  # noqa role-name[path]
    - role: ../roles/win_system_objects_case_insensitivity  # noqa role-name[path]
    - role: ../roles/win_system_objects_strengthen_default_permissions  # noqa role-name[path]
    - role: ../roles/win_uac_admin_approval_builtin_admin  # noqa role-name[path]
    - role: ../roles/win_uac_consent_prompt_behavior_admin  # noqa role-name[path]
    - role: ../roles/win_uac_detect_app_installations  # noqa role-name[path]
    - role: ../roles/win_uac_elevate_uiaccess_secure_locations  # noqa role-name[path]
    - role: ../roles/win_uac_run_all_admins_in_admin_approval_mode  # noqa role-name[path]
    - role: ../roles/win_uac_secure_desktop_prompt  # noqa role-name[path]
    - role: ../roles/win_uac_standard_user_elevation_deny  # noqa role-name[path]
    - role: ../roles/win_uac_virtualize_file_registry_write_failures  # noqa role-name[path]
    - role: ../roles/win_upnp_device_host_disabled  # noqa role-name[path]
    - role: ../roles/win_web_management_service_disabled  # noqa role-name[path]
    - role: ../roles/win_wecsvc_disabled  # noqa role-name[path]
    - role: ../roles/win_wercplsupport_disabled  # noqa role-name[path]
    - role: ../roles/win_windows_error_reporting_service_disabled  # noqa role-name[path]
    - role: ../roles/win_windows_push_notifications_system_service_disabled  # noqa role-name[path]
    - role: ../roles/win_wmp_network_sharing_service_disabled  # noqa role-name[path]
    - role: ../roles/win_world_wide_web_publishing_service_disabled  # noqa role-name[path]
    - role: ../roles/win_xbox_accessory_management_service_disabled  # noqa role-name[path]
    - role: ../roles/win_xbox_live_auth_manager_disabled  # noqa role-name[path]
    - role: ../roles/win_xbox_live_game_save_disabled  # noqa role-name[path]
    - role: ../roles/win_xbox_live_networking_service_disabled  # noqa role-name[path]

  post_tasks:
    - name: Verify all roles completed successfully
      ansible.builtin.debug:
        msg: "All 145 roles have been executed. Check the output above for any errors or warnings."
